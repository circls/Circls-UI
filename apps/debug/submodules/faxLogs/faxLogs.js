define(["require","jquery","underscore","monster","toastr"],function(a){var t=a("jquery"),e=a("underscore"),i=a("monster"),s=(a("toastr"),{requests:{},subscribe:{"debug.faxLogs.render":"faxLogsRender"},faxLogsRender:function(a){var e=this,a=a||{},s=a.container||t("#debug_app_container .app-content-wrapper"),n=t(i.template(e,"faxLogs-layout"));e.faxLogsInitTable(n,function(){e.faxLogsBindEvents(n),s.fadeOut(function(){t(this).empty().append(n).fadeIn()})})},faxLogsBindEvents:function(a){var e=this;a.on("click",".detail-link",function(){var a=t(this).data("id");e.faxLogsRenderDetailPopup(a)})},faxLogsRenderDetailPopup:function(a){var e=this;e.faxLogsGetDetails(a,function(a){var s=t(i.template(e,"faxLogs-detail",a));s.find("#close").on("click",function(){n.dialog("close").remove()});var n=i.ui.dialog(s,{title:e.i18n.active().faxLogs.detailDialog.popupTitle,position:["center",20]})})},faxLogsFormatDataTable:function(a){var e=[];return t.each(a,function(){e.push([this.hasOwnProperty("error"),this.from||"-",this.to||"-",i.util.toFriendlyDate(this.created),this.id,this.id,this.created])}),e},faxLogsFormatDetailData:function(a){var t=this,i={metadata:{},errors:[]},s="";return e.each(a,function(a,e){"errors"===e?i.errors=a:(s=t.i18n.active().faxLogs.detailDialog.apiKeys.hasOwnProperty(e)?t.i18n.active().faxLogs.detailDialog.apiKeys[e]:e.replace(/_/g," "),i.metadata[e]={friendlyKey:s,value:a})}),i},faxLogsInitTable:function(a,e){var s,n,o=this,r=[{sTitle:o.i18n.active().faxLogs.tableTitles.status,fnRender:function(a){return s=a.aData[0],n=s?"thumbs-down monster-red":"thumbs-up monster-green",'<i class="fa fa-'+n+'">'}},{sTitle:o.i18n.active().faxLogs.tableTitles.from},{sTitle:o.i18n.active().faxLogs.tableTitles.to},{sTitle:o.i18n.active().faxLogs.tableTitles.date},{sTitle:o.i18n.active().faxLogs.tableTitles.details,fnRender:function(a){return'<a href="#" class="detail-link monster-link" data-id="'+a.aData[4]+'"><i class="fa fa-eye"></i></a>'}},{sTitle:"ID",bVisible:!1},{sTitle:"Timestamp",bVisible:!1}];o.faxLogsGetData(function(s){i.ui.table.create("faxLogs",a.find("#smtp_logs_grid"),r,s,{sDom:'<"table-custom-actions">frtlip',aaSorting:[[3,"desc"]]}),t.fn.dataTableExt.afnFiltering.pop(),e&&e()})},faxLogsGetData:function(a){var t=this;t.callApi({resource:"faxes.getLogs",data:{accountId:t.accountId},success:function(e){var i=t.faxLogsFormatDataTable(e.data);a&&a(i)}})},faxLogsGetDetails:function(a,t){var e=this;e.callApi({resource:"faxes.getLogDetails",data:{accountId:e.accountId,logId:a},success:function(a){var i=e.faxLogsFormatDetailData(a.data);t&&t(i)}})}});return s});